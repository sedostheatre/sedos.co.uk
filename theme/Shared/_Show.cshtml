@{
    Layout = "_Default";
}

@model IDocument

<div class="show-page-header">
    @Html.Partial("Partials/_ShowHeader", Model)
</div>

<div class="page-section mt-3px">
    <div class="container bg-white">
        <div class="row">
            <div class="col-md-8 pt-3" role="tabpanel">
                <ul class="nav nav-tabs show-nav" role="tablist" id="showDetailsTab">
                    <li class="nav-item">
                        <a class="nav-link active show-details-nav-header" id="details-tab" data-toggle="tab" href="#details" role="tab" aria-controls="details" aria-expanded="false">Details</a>
                    </li>
                    @{
                        foreach(var document in Documents["ShowDetails"].Where(showDetails => showDetails["show"].ToString().Trim() == Model["title"].ToString().Trim()))
                        {
                            <li class="nav-item">
                                <a class="nav-link show-details-nav-header" id="@document["section"]-tab" data-toggle="tab" href="#@document["section"]" role="tab" aria-controls="@document["section"]" aria-expanded="false">@document["section"]</a>
                            </li>
                        }
                    }
                </ul>
                <div class="tab-content" id="showDetailsTabContent">
                    <div role="tabpanel" class="tab-pane fade active show" id="details" aria-labelledby="details-tab" aria-expanded="false">
                        <p>
                            @RenderBody()
                        </p>
                    </div>
                    @{
                        foreach(var document in Documents["ShowDetails"].Where(showDetails => showDetails["show"].ToString().Trim() == Model["title"].ToString().Trim()))
                        {
                            <div class="tab-pane fade" id="@document["section"]" role="tabpanel" aria-labelledby="@document["section"]-tab" aria-expanded="true">
                                <div class="pt-3">
                                    @Html.Raw(document.Content)
                                </div>
                            </div>
                        }
                    }
                </div>
            </div>
            <div class="col-md-4 pt-3 show-timings-column">
                @{
                    if(Model.ContainsKey("venue"))
                    {
                        var venue = Documents["Venues"].FirstOrDefault(x => x["key"].ToString().Equals(Model["venue"].ToString()));
                        if(venue != null)
                        {
                            <h4><a href="@Context.GetLink(venue)">@venue["name"]</a></h4>
                        }
                        else
                        {
                            <h4>@Model["venue"]</h4>
                        }
                    }
                }
                <h4>@Model.Get("ticket-prices")</h4>
                @{
                    var showDates = Model.Get<IEnumerable<IDocument>>("showtimes").Select(x => x.Get<DateTime>("time")).OrderBy(x => x);
                    if(showDates.Any())
                    {
                        <ul>
                            @foreach(var showDate in showDates.Select(x => x.ToString("dddd d MMMM yyyy h.mm") + x.ToString("tt").ToLower()))
                            {
                                <li>@showDate</li>
                            }
                        </ul>

                        if(showDates.Any(x => x > DateTime.Now))
                        {
                            <button class="btn btn-sedos-blue">Book tickets</button>
                        }
                    }
                }
            </div>
        </div>
    </div>
</div>
